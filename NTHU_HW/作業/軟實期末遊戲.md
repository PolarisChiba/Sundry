---
tags: 清大作業
---

# 軟體實驗設計 期末遊戲

[TOC]

## 音樂

背景音樂為1812序曲。

## 登入

輸入電子郵件與密碼後，點選註冊或者登入即可。

## 大廳

左方會顯示郵件、勝場數、敗場數、殺人數。

右方主要有以下功能：

1. 烏俄戰爭地圖的遊戲等待
2. 白色/黃色方案地圖的遊戲等待
3. 自定義地圖的遊戲等待
4. 客製化地圖
5. 顯示某個已知地圖的所有訊息
6. 清除等待佇列

點擊waiting後可以將目前的等待取消。

## 遊戲

### 內容

兩個或多個政權之間互相的戰鬥。

* 有著戰爭迷霧。
    * 只能看到相鄰一格的敵對格子。
* 任何操作都是即時的、是畫面的更新是離散的
    * 也就是說，玩家每次操作都會即時上傳firebase，並經由server處理；但server每隔一個固定時間才會回傳當前的地圖，來讓玩家的遊戲畫面更新
* server的實作為peer-to-peer
    * 會由第一個進行等待的玩家電腦當作server。
    * 遊戲進行時，會由當作server的電腦來偵測firebase資料上的改變，並進行對應的運算。

### 玩法

（食物即為費用）

#### 視角

按住shift，以滑鼠按住拉動即可移動畫面視角。

#### 移動

點擊格子後，以右方的資訊欄來控制要移動的人數、裝備數、食物數，預設是全部。
按Q可以直接選取一半的人數、裝備數、食物數。
以WASD控制移動方位，每次只能移動一格。
移動中的單位會從畫面顯示中消失，直到下一次畫面更新時才會顯示結果。

#### 進攻

當移動到敵對格子時即為進攻。

#### 傷害

```
if equip * 100 >= soldier:
    damage = soldier / 2;
else:
    damage = (soldier - 100 * equip) / 10 + 100 * equip / 2;
damage *= (1 - citylevel * 0.05) * (1 - industrylevel * 0.005)
if (soldier > food)
    damage = 0.5 * damage + 0.5 * damage * food / soldier
if (trench)
    damage *= 0.8
if (nature)
    damage *= 0.9
if (fort)
    damage *= 1.1
```

受到傷害值會減少等量的soldier數，並且減少傷害 / 500的soldier數。

當進攻的格子的 soldier 數減少至零時即為攻佔。
並且會接收剩下的 equip 與 food。

#### 基礎設備

1. City
    - 每回合會根據等級數增加soldier數
    - 每回合會根據等級數增加food數
    - 1000 * level
    - 升級費用為 8000 * (level + 1)
2. Industry
    - 每回合會根據等級數增加equip數
    - 10 * level
    - 升級費用為 5000 * (level + 1)
3. Farm
    - 每回合會根據等級數增加food數
    - 2000 * level
    - 升級費用為 5000 * (level + 1)

最高等級皆為五級。

每回合會以 soldier / 10 的數量減少食物。
食物減少到零後，每回合 soldier 會減少四成。

#### 特殊設備

1. airport
    - 建造費用 10000
    - 支付 40 equip 後可以一次移動部隊兩格
    - 點擊右方move後，再點擊目的地即可
2. missile
    - 建造費用 10000
    - 支付 40 equip 後可以對三格以內的敵方格子造成 1500 點傷害
3. trench
    - 提供防禦buff
    - 建造費用 10000
4. fort
    - 提供攻擊buff
    - 建造費用 20000
5. nature
    - 提供防禦buff
    - 無法建造

### 烏俄戰爭 地圖

|                                            |                                |                                            |                                                                        |                                                              |                                                                    |                                              |     |                |                                                       |
|:------------------------------------------:|:------------------------------:|:------------------------------------------:|:----------------------------------------------------------------------:|:------------------------------------------------------------:|:------------------------------------------------------------------:|:--------------------------------------------:|:---:|:--------------:|:-----------------------------------------------------:|
|                                            | Rivne<br>5000/30/8000<br>城市I |              10000/120/10000               | Kyiv<br>25000/200/50000<br>城市IV<br>機場<br>工業II<br>河流<br>農場III |           Sumy<br>10000/60/10000<br>城市I<br>農業I            |                          15000/150/20000                           |                10000/80/13000                |     |      導彈      |    Kursk<br>45000/600/63000<br>城市III<br>工業III     |
| Lviv<br>10000/70/20000<br>城市II<br>工業I |                                |                                            |                             5000/30/10000<br>河流<br>農場II                             |                    河流<br>農場I                     | Kharkiv<br>20000/100/40000<br>城市III<br>工業II<br>農業III |                                              |     |                |                     5000/50/7000                      |
|                    機場                    |                                |                                            |              Mykolaiv<br>5000/20/10000<br>城市I <br>農場II              | Dnipro<br>5000/30/15000<br>城市II<br>河流<br>農場II<br>工業I |                                                                    |  Luhansk<br>15000/120/15000<br>城市I<br>壕溝  |     |                | Rostov<br>30000/200/43000<br>城市II<br>工業I<br>農業I |
|                                            |                                | Odessa<br>10000/60/20000<br>城市II<br>機場 |                                                                        |      Kherson<br>12000/70/20000<br>城市I<br>機場<br>河流      |          Zaporizhzhia<br>5000/60/6000<br>城市I<br>工業I           | Donetsk<br>10000/90/10000<br>城市II<br>工業I<br>壕溝 |     | 15000/120/20000 |                                                       |
|                                            |                                |                                            |                                                                        |              Crimea<br>20000/250/24000<br>城市I              |                                                                    |                                              |     |                |                                                       |

### Fall 地圖
https://docs.google.com/spreadsheets/d/1NjghzBphtac9NnBs8E3P-AnxUShybTPpX_fzFbMsMEE/edit?usp=sharing

## 已知BUG

1. 在等待遊戲時關閉視窗時，並不會取消等待
    - 解決方案為ResetAll的按鈕，這會將所有當前的等待取消
    - 這個解決方法好暴力（?）
2. 在遊戲中，在移動了視野之後，右方資訊欄的scrollbar位置會失真，只能以拉動圓環的方式來調整而不能以點擊方式調整
    - 這點提供 q 鍵以直接選取一半
3. 因為是以類似peer-to-peer的方式進行，因此如果擔任server的那台電腦離開視窗的話，會導致遊戲卡住
    - 解決方案為Back按鈕，發現遊戲斷掉的話就按Back直接回到大廳
4. 有時候登入頁面會自動填入帳號，點擊帳號與密碼時分別可能造成另一欄被清空（這應該不是程式碼的問題）
    - 解決方法，輸入完郵件後，點擊旁邊空白處，再點擊密碼即可正常輸入
5. (不算 bug 但我覺得 QQ) 視窗大小要動態(?)
    - 也可以試著做做看OuO

## Todo
以下內容皆非必要完成，只是我個人的建議
有想到的人可以再加

1. 客製化地圖的介面有點陽春(黃雅筠)
    - 改成先產生 n * m 地圖後針對各格子修改資訊(類似目前遊戲過程的畫面)
2. 地圖的格子非常的陽春 (陳柏睿)
    - 將原先的色塊改成以不同顏色深淺的地板來區分
    - 在格子右下方新增小插圖，用來顯示城市的等級(Lv1、2、3、4&5，共4種，Lv0時不顯示)
    - 切換至"ShowArmy"時，以三個小插圖取代原先的S、E、F字樣
    - 迷霧區(未和目前已知格子相鄰)以霧的插圖覆蓋
    - 為了使迷霧更逼真，移除地圖格子框線
    - 結算畫面的返回鍵改成箭頭圖案的小插圖、新增MissionComplete插圖
    - 登入畫面的SignIn、SignUp以兩張新插圖代替
    - UserProfile的頁面，按鈕上新增小插圖
3. ~~顯示已知地圖的功能尚未實作(黃雅筠)~~
4. ~~登出(黃雅筠)~~
5. ~~上傳照片(黃雅筠，有空的話)~~
6. 音效，在某些動作時播放音效(陳柏睿？)
7. 轉場動畫，目前的動畫是漸淡，可能有點陽春？
8. ~~遊戲規則介紹的畫面(陳柏睿)~~
9. DEMO 投影片(裘歷)
10. 交戰區域，在新回合開始時產生一點粒子散射特效

還要決定遊戲名稱

註解
地圖的格子在程式碼中是由showname、showarmy、showlevel、showvisible控制

## 自評表

### 人物移動/操控

* 在遊戲畫面中按下shift的同時按下滑鼠移動，可以移動視野
* 點擊格子，並且可以在右方資訊欄中調整要移動的數量，接著可以利用WASD向四周移動
* 點擊格子後，可以利用 q 鍵快速選取一半的數量
* 若有機場，可以點擊格子、選取數量後，按下move後，再點擊要移動的位置即可移動過去

### 雲端存檔

* 地圖，儲存遊戲地圖，包含名稱、長寬、玩家數、每個格子的初始資訊
* 帳號，儲存勝場數、敗場數、總kill的soldier數
* 房間，包含wait、battle、result三種狀態
    * wait，等待其他玩家，包含有哪些玩家
    * battle，與其他玩家對戰，包含當前的地圖與行動的資訊
    * result，結算狀態，包含每位玩家的結果的資訊
在battle時，使用了類似peer-to-peer的方法，藉由firebase的即時資料庫來達成連線對戰
更仔細來說，會有一位玩家的電腦當作server，去監聽firebase上的資料變化

### 動畫

* 目前只有簡易的轉場淡化的動畫
* 還有顯示結算畫面時的淡入特效
* 視情況希望能多加一點動畫呈現

### 粒子特效

* 暫時沒有
* 希望能夠在遊戲過程中，交戰時產生粒子特效，但還沒有

### 敵人索敵算法

* 沒有，這次開發的遊戲是由玩家之間互相對戰的
* 相對的，有著詳細的生產資源、交戰傷害等計算的機制
* 還有一些特殊機制，像是機場、導彈等等

### 單機多人

* 僅能多人遊玩，或是一個人開多個帳號玩

### 多人連線

* 沒有限制人數，但目前只有三人以內時會有正常的畫面呈現
* 使用類似peer-to-peer的方法來達成連線對戰
* 由一人的電腦當作server
* client每有操作，就會即時上傳到fiebase；server的電腦也會即時抓下來處理
* 每隔一段時間，server會將當前的地圖更新到firebase上，以達成離散的回合效果

### 關卡編輯器

* 很陽春的關卡編輯器算是關卡編輯器嗎@@
* 有，可以創作地圖
* 首先要設定地圖的名稱、長寬、玩家人數
* 再來要對每一個格子進行詳細的設定

### 其他技術項目

* 固定畫面物件，移動視角的時候，資訊欄會固定不動
* 類似peer-to-peer的連線方式
* 直接關閉遊戲視窗這個動作並不會登出帳號，因此會造成程式誤以為玩家其實還在的假象，因此提供了ResetAll、Back等按鈕來處理這樣的問題
* 特別設計過的登入、大廳與結算畫面的背景
* 酷酷的地圖設計
* 背景音樂為1812序曲，希望能夠有許多契合遊戲的音效，但目前還沒有

